---
- import_tasks: mac.yml
  when: ansible_os_platform|lower == 'mac'

- import_tasks: fedora.yml
  when: ansible_facts['distribution'] == 'Fedora'

- name: Clone asdf
  ansible.builtin.git:
    repo: https://github.com/asdf-vm/asdf.git
    dest: ~/.asdf
    single_branch: yes
    version: v0.9.0

- name: create zshrc.d directory if it doesn't exist
  ansible.builtin.file:
    path: ~/.config/zsh/zshrc.d
    state: directory

- name: generate plugin file
  ansible.builtin.template:
    src: "{{ role_path }}/files/asdf.j2"
    dest: "{{ zshrc_dir }}/asdf.zsh"
    mode: u=rx

- name: find asdfrc
  find:
    paths: "{{ role_path + '/files' }}"
    patterns:
      - asdfrc
    depth: 1
    file_type: any
  register: nvim_role_files

- name: Symlink config
  file:
    src: "{{ item.path }}"
    dest: "~/.{{ item.path.split('/')[-1] }}"
    state: link
  loop: "{{ nvim_role_files.files }}"

- name: install asdf nodejs plugin
  shell: asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git
  register: result
  failed_when: "'Plugin named nodejs already added' not in result.stderr"

- name: install asdf go plugin
  shell: asdf plugin add golang https://github.com/kennyp/asdf-golang.git
  register: result
  failed_when: "'Plugin named golang already added' not in result.stderr"


